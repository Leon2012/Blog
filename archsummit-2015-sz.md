title: Arch Summit 2015 @ ShenZhen
date: 2015/7/19 20:00:00
tags: [ArchSummit]
categories: uncategorized
---

这两天参加了ArchSummit 2015在深圳的大会, 记录一下.
貌似这种大会都差不多, 偶尔会碰到干货, 但是很少. 一般都是上来介绍背景, 中间讲讲技术, 最后再打个广告, 要么是推荐自家产品要么是招人, 完了就是问答环节.
问题是有很多都是介绍背景会花很多时间, 真正讲技术的时间很少, 有的讲也是泛泛而谈介绍下概念, 而且还有些讲师没有控制好时间, 第一个环节讲很多扯太远收不回来, 结果讲技术的时候又时间不够.
而且我发现有两个讲师的讲稿, 中间有几页内容是雷同的, 图片完全一样只是文字排版有点差异, 很明显他们不是互相抄袭对方的, 也就是说他们同时借鉴别人的然后"撞衫"了...

<!--more-->

好吧, 吐槽完了, 虽然收获没有想象的那么多, 但也还是有的, 简单记录下.

## 环信
因为本身做的东西和环信很类似, 所以对这个最感兴趣, 最后也找讲师提了几个问题.
- 他们也是开始用的基于ejabberd的xmpp协议, 后来自己优化. 从xmpp协议到私有协议, 我们也经历过这个历程, 貌似陌陌也是.
- 他们所有的服务器都是用虚拟机, 而我们目前IM和MQ服务器都是用的物理机, 一直都担心虚拟机撑不住, 以后也可以试下.
- 我们目前用户状态还是用的集群同步, 这也是比较坑也是我们一直想去优化的, 问了他们是自己用erlang写的共享缓存.
- 拆子系统的思路跟我们一样, 他们已经用上了Spring Boot.
- 他们DB主要用的是Cassandra.
- 离线消息存储他们用的是MySql, 这个我有点怀疑, 只是当时没有来得及问. 因为离线消息读写很频繁, 而且时效性要求也高, 如果只是用MySql估计很难搞定.
- 他们说已经实现了多活, 这个有点强大. 多个数据中心之间的数据同步用Flume.
- 他们的自动化运维工具也很强大.


## 微信朋友圈
个人认为这是本次大会听到的最有料的一场演讲, [PPT里也有很多干货](http://pan.baidu.com/s/1pJ5Pipd), 而且讲师讲的也比较好, 从易到难, 从单机房到多机房跨洋同步, 从简单的发表朋友圈逻辑到复杂的点赞和评论逻辑, 循序渐进, 讲的比较透彻.
- 他们的团队很小, 开发效率很高; 他们通过灰度发布可以随时切换流量验证, 所以开发可以随时发布变更, 只要灰度发布验证通过.
- 他们的数据是存储在他们自己实现的一个强大的KV存储上的, 我倒是很期待他们这个存储能够开源出来...
- 数据存储跟我们的设计也差不多, 只是我们很多数据例如关系链, 时间线都是非常依赖redis的, 他们用自己的KV存储.
- 我们目前只是实现了微信朋友圈的基本功能, 还没有涉及到多机房甚至是跨洋机房同步, 而这一块是相对最难的.
- 通过偏序来保证因果一致性. 不同机房之间通过求模方式生成序列.

具体的其实看他PPT也基本上都能看懂, 只是我还是有些另外的疑问:
1, 朋友圈跨洋机房同步数据即使有延迟也影响不大, 但是消息通讯实时性要求很高, 不知道他们是怎么解决延时的问题.
2, 机房之间切换的问题, 例如出差国内外飞来飞去, 涉及到机房切换, 这一块逻辑处理应该也比较复杂.

## 微服务, 容器
这也是现在比较火的, 很多演讲都有介绍.
所以我也打算看下Spring Boot, Spring Cloud之类的技术.
Docker之前自己有学习了解过, 还没有真正应用起来.
PS: 大会上有个叫Josh Long的老外很牛, 介绍微服务和Spring的, 一边演讲一边现场敲代码演示...


## 双活/多活
环信和微信都说实现了多活.
另外有一个招行的讲师, 他有个说法是: 同城做双活异地做主被. 因为双活的网络耗时是有要求的, 一般异地是达不到的, 只能是同城多机房.
所以我也很困惑异地到底能不能做双活.

## "不懂运维的程序员不是好的架构师"
这个说法貌似听到好几次, 现在不是流行DevOps嘛, 一些监控和运维的问题还是需要我们在开发的过程中去思考和解决.


## 方法和实践
有个腾讯的讲师介绍了一些他们的研发经验:
### 敏捷开发
- 小步快跑, 快速迭代
- 灰度发布
- 动态运营
- 数据驱动运营
- 轻端重云

### 海量服务
- 大系统小做
- 有损服务
- 柔性可用
- 先扛住再优化

这些理念其实之前也多多少少听到过, 这里总结下.


其他还有很多介绍云, 大数据, APM性能管理的课题, 因为跟其他课题冲突以及跟我目前的工作关系不是很大, 所以没有花太多时间去听.
